name: Django CI

on:
  push:
    branches: [ "main" ]
    
jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        python-version: [3.7, 3.8, 3.9]

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
      run: ls -la
      
 #   - name: Create a Python virtual environment
 #     working-directoty: ./pyramid_blogr
 #     run: python3 -m venv env |

# Upgrade packaging tools
         env/bin/pip install --upgrade pip setuptools

# Install the project in editable mode with its testing requirements
      run: env/bin/pip install -e ".[testing]"

# Initialize and upgrade the database using Alembic
    # Generate your first revision.
      run: env/bin/alembic -c development.ini revision --autogenerate -m "init"
    # Upgrade to that revision.
      run: env/bin/alembic -c development.ini upgrade head
# Load default data into the database using a script.
      run: env/bin/initialize_pyramid_blogr_db development.ini
# Run your project's tests.
      run: env/bin/pytest
# Run your project.
      run: env/bin/pserve development.ini   
        
        
        
        
#    - name: Install Dependencies
 #     run: |
  #      python -m pip install --upgrade pip
   #     pip install -r requirements.txt
    #- name: Run Tests
     # run: |
      #  python setup.py test
